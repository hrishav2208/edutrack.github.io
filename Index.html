<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTrack - Smart College Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .face-scan-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .notification-badge {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .defaulter-row {
            background: linear-gradient(90deg, #fee2e2 0%, #fef2f2 100%);
        }
        .excellent-row {
            background: linear-gradient(90deg, #dcfce7 0%, #f0fdf4 100%);
        }
        .good-row {
            background: linear-gradient(90deg, #dbeafe 0%, #eff6ff 100%);
        }
        .warning-row {
            background: linear-gradient(90deg, #fef3c7 0%, #fffbeb 100%);
        }
        .camera-preview {
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="text-2xl font-bold">üìö EduTrack</div>
                    <div class="ml-8 hidden md:block">
                        <span class="text-sm opacity-90">Smart College Management System</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="notificationBtn" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors">
                            üîî
                            <span class="notification-badge absolute -top-1 -right-1 bg-red-500 text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                        </button>
                    </div>
                    <div class="flex items-center space-x-2">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23f3f4f6'/%3E%3Ccircle cx='16' cy='12' r='5' fill='%236b7280'/%3E%3Cpath d='M16 18c-5 0-9 3-9 6v2h18v-2c0-3-4-6-9-6z' fill='%236b7280'/%3E%3C/svg%3E" alt="Profile" class="w-8 h-8 rounded-full">
                        <span id="currentUser" class="text-sm font-medium">Admin User</span>
                        <button id="logoutBtn" class="text-sm hover:underline">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-4xl mb-4">üìö</div>
                <h1 class="text-3xl font-bold text-gray-800">EduTrack</h1>
                <p class="text-gray-600 mt-2">Smart College Management System</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your email" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your password" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                    <select id="userRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="admin">Admin</option>
                        <option value="teacher">Teacher</option>
                        <option value="student">Student</option>
                        <option value="parent">Parent</option>
                    </select>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    Sign In
                </button>
                
                <div class="text-center">
                    <button type="button" id="biometricBtn" class="text-blue-600 hover:underline text-sm">
                        üîí Use Biometric Login (Demo)
                    </button>
                </div>
            </form>
            
            <div class="mt-6 text-center text-sm text-gray-600">
                <p>Demo Credentials:</p>
                <p>admin@edutrack.com / teacher@edutrack.com / student@edutrack.com</p>
                <p>Password: demo123</p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" class="hidden">
        <!-- Role-based Dashboard Content -->
        
        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden p-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
                    <p class="text-gray-600">College-wide insights and management</p>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Students</p>
                                <p class="text-3xl font-bold text-blue-600">2,847</p>
                            </div>
                            <div class="text-4xl">üë•</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Active Teachers</p>
                                <p class="text-3xl font-bold text-green-600">156</p>
                            </div>
                            <div class="text-4xl">üë®‚Äçüè´</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Avg Attendance</p>
                                <p class="text-3xl font-bold text-purple-600">87.3%</p>
                            </div>
                            <div class="text-4xl">üìä</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Defaulters (<75%)</p>
                                <p class="text-3xl font-bold text-red-600">23</p>
                            </div>
                            <div class="text-4xl">‚ö†Ô∏è</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Placement Rate</p>
                                <p class="text-3xl font-bold text-indigo-600">94.2%</p>
                            </div>
                            <div class="text-4xl">üéØ</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <button id="viewDefaultersBtn" class="bg-red-600 text-white rounded-xl p-4 text-left hover:bg-red-700 transition-colors">
                        <div class="text-2xl mb-2">‚ö†Ô∏è</div>
                        <h3 class="font-semibold">View Defaulters</h3>
                        <p class="text-sm opacity-90">Students below 75%</p>
                    </button>
                    
                    <button id="academicCalendarBtn" class="bg-blue-600 text-white rounded-xl p-4 text-left hover:bg-blue-700 transition-colors">
                        <div class="text-2xl mb-2">üìÖ</div>
                        <h3 class="font-semibold">Academic Calendar</h3>
                        <p class="text-sm opacity-90">Events & Deadlines</p>
                    </button>
                    
                    <button id="examScheduleBtn" class="bg-green-600 text-white rounded-xl p-4 text-left hover:bg-green-700 transition-colors">
                        <div class="text-2xl mb-2">üìù</div>
                        <h3 class="font-semibold">Exam Schedule</h3>
                        <p class="text-sm opacity-90">Upcoming Exams</p>
                    </button>
                    
                    <button id="placementStatsBtn" class="bg-purple-600 text-white rounded-xl p-4 text-left hover:bg-purple-700 transition-colors">
                        <div class="text-2xl mb-2">üè¢</div>
                        <h3 class="font-semibold">Placement Stats</h3>
                        <p class="text-sm opacity-90">Company Visits</p>
                    </button>
                </div>
                
                <!-- Charts and Analytics -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Attendance Trends</h3>
                        <canvas id="attendanceChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Department Performance</h3>
                        <canvas id="performanceChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <!-- AI Insights -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">ü§ñ AI Insights & Predictions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <h4 class="font-medium text-red-800">High Risk Students</h4>
                            <p class="text-sm text-red-600 mt-1">23 students predicted to fail due to low attendance</p>
                            <button class="mt-2 text-xs bg-red-600 text-white px-3 py-1 rounded">View Details</button>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="font-medium text-yellow-800">Curriculum Gaps</h4>
                            <p class="text-sm text-yellow-600 mt-1">5 courses need updated materials</p>
                            <button class="mt-2 text-xs bg-yellow-600 text-white px-3 py-1 rounded">Review</button>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-medium text-green-800">Top Performers</h4>
                            <p class="text-sm text-green-600 mt-1">Computer Science dept leading with 94% attendance</p>
                            <button class="mt-2 text-xs bg-green-600 text-white px-3 py-1 rounded">Celebrate</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Teacher Dashboard -->
        <div id="teacherDashboard" class="hidden p-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Teacher Dashboard</h1>
                    <p class="text-gray-600">Manage your classes and curriculum</p>
                </div>
                
                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <button id="takeAttendanceBtn" class="bg-blue-600 text-white rounded-xl p-6 text-left hover:bg-blue-700 transition-colors">
                        <div class="text-3xl mb-2">üìã</div>
                        <h3 class="text-lg font-semibold">Take Attendance</h3>
                        <p class="text-sm opacity-90">Mark today's attendance</p>
                    </button>
                    
                    <button id="uploadCurriculumBtn" class="bg-green-600 text-white rounded-xl p-6 text-left hover:bg-green-700 transition-colors">
                        <div class="text-3xl mb-2">üìö</div>
                        <h3 class="text-lg font-semibold">Upload Curriculum</h3>
                        <p class="text-sm opacity-90">Add lesson plans & resources</p>
                    </button>
                    
                    <button id="viewReportsBtn" class="bg-purple-600 text-white rounded-xl p-6 text-left hover:bg-purple-700 transition-colors">
                        <div class="text-3xl mb-2">üìä</div>
                        <h3 class="text-lg font-semibold">View Reports</h3>
                        <p class="text-sm opacity-90">Class analytics & insights</p>
                    </button>
                    
                    <button id="teacherDefaultersBtn" class="bg-red-600 text-white rounded-xl p-6 text-left hover:bg-red-700 transition-colors">
                        <div class="text-3xl mb-2">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold">Defaulter List</h3>
                        <p class="text-sm opacity-90">Students below 75%</p>
                    </button>
                </div>

                <!-- Student List -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold">My Students - Computer Science 101</h3>
                        <div class="flex space-x-2">
                            <select id="attendanceFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">All Students</option>
                                <option value="excellent">Excellent (‚â•90%)</option>
                                <option value="good">Good (75-89%)</option>
                                <option value="warning">Warning (60-74%)</option>
                                <option value="defaulter">Defaulters (<60%)</option>
                            </select>
                            <button id="exportAttendanceBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">
                                üìä Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Roll No.</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Student Name</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Attendance %</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Classes Attended</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Last Seen</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                <!-- Students will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- My Classes -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">Today's Schedule</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                            <div>
                                <h4 class="font-medium">Computer Science 101</h4>
                                <p class="text-sm text-gray-600">9:00 AM - 10:30 AM ‚Ä¢ Room 204 ‚Ä¢ 45 students</p>
                                <p class="text-sm text-green-600">‚úÖ Attendance: 42/45 students (93.3%)</p>
                            </div>
                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">View Details</button>
                        </div>
                        
                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                            <div>
                                <h4 class="font-medium">Data Structures Lab</h4>
                                <p class="text-sm text-gray-600">2:00 PM - 4:00 PM ‚Ä¢ Lab 301 ‚Ä¢ 30 students</p>
                                <p class="text-sm text-orange-600">‚è≥ Upcoming class</p>
                            </div>
                            <button class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Prepare</button>
                        </div>

                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                            <div>
                                <h4 class="font-medium">Algorithm Design</h4>
                                <p class="text-sm text-gray-600">4:30 PM - 6:00 PM ‚Ä¢ Room 105 ‚Ä¢ 38 students</p>
                                <p class="text-sm text-blue-600">üìö Theory Class</p>
                            </div>
                            <button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Start Class</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Student Dashboard -->
        <div id="studentDashboard" class="hidden p-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Student Dashboard</h1>
                    <p class="text-gray-600">Track your academic progress</p>
                </div>
                
                <!-- Student Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Attendance Rate</p>
                                <p class="text-3xl font-bold text-green-600">92.5%</p>
                            </div>
                            <div class="text-4xl">‚úÖ</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Current CGPA</p>
                                <p class="text-3xl font-bold text-blue-600">8.7</p>
                            </div>
                            <div class="text-4xl">üéì</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Credits Earned</p>
                                <p class="text-3xl font-bold text-purple-600">142</p>
                            </div>
                            <div class="text-4xl">üìö</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Pending Tasks</p>
                                <p class="text-3xl font-bold text-orange-600">5</p>
                            </div>
                            <div class="text-4xl">üìù</div>
                        </div>
                    </div>
                </div>

                <!-- Academic Performance -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Semester Performance</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                <span class="font-medium">Data Structures</span>
                                <span class="text-green-600 font-bold">A+ (9.5)</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                <span class="font-medium">Computer Networks</span>
                                <span class="text-blue-600 font-bold">A (8.8)</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                <span class="font-medium">Database Systems</span>
                                <span class="text-purple-600 font-bold">A (8.5)</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                <span class="font-medium">Software Engineering</span>
                                <span class="text-yellow-600 font-bold">B+ (7.8)</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Attendance by Subject</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">Data Structures</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: 95%"></div>
                                    </div>
                                    <span class="text-sm font-bold text-green-600">95%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">Computer Networks</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: 88%"></div>
                                    </div>
                                    <span class="text-sm font-bold text-blue-600">88%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">Database Systems</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div class="bg-purple-600 h-2 rounded-full" style="width: 92%"></div>
                                    </div>
                                    <span class="text-sm font-bold text-purple-600">92%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium">Software Engineering</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-600 h-2 rounded-full" style="width: 78%"></div>
                                    </div>
                                    <span class="text-sm font-bold text-yellow-600">78%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Today's Schedule -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">Today's Schedule</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div>
                                <h4 class="font-medium text-green-800">Data Structures</h4>
                                <p class="text-sm text-green-600">9:00 AM - 10:30 AM ‚Ä¢ Prof. Johnson ‚Ä¢ Room 204</p>
                            </div>
                            <span class="text-green-600 font-medium">‚úÖ Present</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <div>
                                <h4 class="font-medium text-blue-800">Database Lab</h4>
                                <p class="text-sm text-blue-600">2:00 PM - 4:00 PM ‚Ä¢ Dr. Smith ‚Ä¢ Lab 301</p>
                            </div>
                            <button id="markAttendanceBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Mark Attendance</button>
                        </div>

                        <div class="flex items-center justify-between p-3 bg-purple-50 border border-purple-200 rounded-lg">
                            <div>
                                <h4 class="font-medium text-purple-800">Software Engineering</h4>
                                <p class="text-sm text-purple-600">4:30 PM - 6:00 PM ‚Ä¢ Prof. Wilson ‚Ä¢ Room 105</p>
                            </div>
                            <span class="text-gray-500 font-medium">‚è∞ Upcoming</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Access -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Course Materials</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm">üìÑ Data Structures Notes - Trees</span>
                                <button class="text-blue-600 hover:underline text-sm">Download</button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">üé• Database Lecture Recording</span>
                                <button class="text-blue-600 hover:underline text-sm">Watch</button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">üìä Assignment Guidelines</span>
                                <button class="text-blue-600 hover:underline text-sm">View</button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">üíª Lab Manual - SQL Queries</span>
                                <button class="text-blue-600 hover:underline text-sm">Download</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Upcoming Deadlines</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium">Database Assignment 3</p>
                                    <p class="text-xs text-gray-600">Due: Tomorrow 11:59 PM</p>
                                </div>
                                <span class="text-red-600 text-xs font-bold">High Priority</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium">Software Project Phase 2</p>
                                    <p class="text-xs text-gray-600">Due: Friday 6:00 PM</p>
                                </div>
                                <span class="text-orange-600 text-xs font-bold">Medium</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium">Network Security Report</p>
                                    <p class="text-xs text-gray-600">Due: Next Monday</p>
                                </div>
                                <span class="text-green-600 text-xs font-bold">Low</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Parent Dashboard -->
        <div id="parentDashboard" class="hidden p-6">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Parent Dashboard</h1>
                    <p class="text-gray-600">Monitor your child's academic progress</p>
                </div>
                
                <!-- Child Selection -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">Select Child</h3>
                    <select class="w-full md:w-auto px-4 py-2 border border-gray-300 rounded-lg">
                        <option>Arjun Sharma - B.Tech CSE 3rd Year</option>
                        <option>Priya Sharma - B.Tech ECE 1st Year</option>
                    </select>
                </div>
                
                <!-- Child's Performance -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Attendance This Month</p>
                                <p class="text-3xl font-bold text-green-600">95.2%</p>
                            </div>
                            <div class="text-4xl">üìÖ</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Current CGPA</p>
                                <p class="text-3xl font-bold text-blue-600">8.4</p>
                            </div>
                            <div class="text-4xl">üìä</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Semester Rank</p>
                                <p class="text-3xl font-bold text-purple-600">12</p>
                            </div>
                            <div class="text-4xl">üèÜ</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Missed Classes</p>
                                <p class="text-3xl font-bold text-orange-600">2</p>
                            </div>
                            <div class="text-4xl">‚ö†Ô∏è</div>
                        </div>
                    </div>
                </div>

                <!-- Academic Progress -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Subject-wise Performance</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                <div>
                                    <p class="font-medium">Data Structures & Algorithms</p>
                                    <p class="text-sm text-gray-600">Attendance: 96% | Grade: A+</p>
                                </div>
                                <span class="text-green-600 font-bold">9.2</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                <div>
                                    <p class="font-medium">Database Management Systems</p>
                                    <p class="text-sm text-gray-600">Attendance: 92% | Grade: A</p>
                                </div>
                                <span class="text-blue-600 font-bold">8.8</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                <div>
                                    <p class="font-medium">Software Engineering</p>
                                    <p class="text-sm text-gray-600">Attendance: 78% | Grade: B+</p>
                                </div>
                                <span class="text-yellow-600 font-bold">7.5</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Fee Status & Placement</h3>
                        <div class="space-y-4">
                            <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                                <h4 class="font-medium text-green-800">Fee Status</h4>
                                <p class="text-sm text-green-600">All fees paid for current semester</p>
                                <p class="text-xs text-gray-500">Next due: Jan 15, 2024</p>
                            </div>
                            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                <h4 class="font-medium text-blue-800">Placement Preparation</h4>
                                <p class="text-sm text-blue-600">Registered for campus placements</p>
                                <p class="text-xs text-gray-500">Mock interviews: 3 completed</p>
                            </div>
                            <div class="p-3 bg-purple-50 border border-purple-200 rounded-lg">
                                <h4 class="font-medium text-purple-800">Internship Status</h4>
                                <p class="text-sm text-purple-600">Summer internship at TechCorp</p>
                                <p class="text-xs text-gray-500">Duration: May - July 2024</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Alerts -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">Recent Alerts & Notifications</h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="text-green-600">‚úÖ</div>
                            <div>
                                <p class="text-sm font-medium text-green-800">Excellent Performance</p>
                                <p class="text-xs text-green-600">Arjun scored 95% in Database Systems mid-term exam</p>
                                <p class="text-xs text-gray-500">2 hours ago</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start space-x-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="text-yellow-600">‚ö†Ô∏è</div>
                            <div>
                                <p class="text-sm font-medium text-yellow-800">Attendance Warning</p>
                                <p class="text-xs text-yellow-600">Software Engineering attendance dropped to 78%. Needs improvement.</p>
                                <p class="text-xs text-gray-500">1 day ago</p>
                            </div>
                        </div>

                        <div class="flex items-start space-x-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <div class="text-blue-600">üìö</div>
                            <div>
                                <p class="text-sm font-medium text-blue-800">Assignment Submitted</p>
                                <p class="text-xs text-blue-600">Database project submitted on time with excellent quality</p>
                                <p class="text-xs text-gray-500">3 days ago</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Communication -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold mb-4">Teacher Communication</h3>
                    <div class="space-y-3">
                        <button class="w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Message from Prof. Johnson (Data Structures)</p>
                                    <p class="text-sm text-gray-600">Arjun is showing excellent progress in algorithms...</p>
                                </div>
                                <span class="text-xs text-gray-500">2 days ago</span>
                            </div>
                        </button>
                        
                        <button class="w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Message from Dr. Smith (Software Engineering)</p>
                                    <p class="text-sm text-gray-600">Please ensure regular attendance for better understanding...</p>
                                </div>
                                <span class="text-xs text-gray-500">5 days ago</span>
                            </div>
                        </button>
                        
                        <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            Schedule Parent-Teacher Meeting
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Defaulter List Modal -->
    <div id="defaulterModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 w-full max-w-6xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-red-600">‚ö†Ô∏è Defaulter List - Students Below 75% Attendance</h2>
                <button id="closeDefaulterModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="mb-4 flex justify-between items-center">
                <div class="flex space-x-4">
                    <select id="departmentFilter" class="px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="all">All Departments</option>
                        <option value="cse">Computer Science</option>
                        <option value="ece">Electronics</option>
                        <option value="me">Mechanical</option>
                        <option value="ce">Civil</option>
                    </select>
                    <select id="severityFilter" class="px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="all">All Severity</option>
                        <option value="critical">Critical (<50%)</option>
                        <option value="high">High (50-60%)</option>
                        <option value="medium">Medium (60-75%)</option>
                    </select>
                </div>
                <button id="exportDefaultersBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                    üìä Export Report
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200 bg-gray-50">
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Roll No.</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Student Name</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Department</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Attendance %</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Classes Missed</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Severity</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Parent Contact</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="defaulterTableBody">
                        <!-- Defaulters will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Attendance Modal -->
    <div id="attendanceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">Mark Attendance</h2>
            
            <div class="space-y-6">
                <!-- Face Recognition Option -->
                <button id="faceRecognitionBtn" class="w-full bg-blue-600 text-white p-4 rounded-xl hover:bg-blue-700 transition-colors">
                    <div class="face-scan-animation text-3xl mb-2">üì∑</div>
                    <div class="font-medium">Face Recognition</div>
                    <div class="text-sm opacity-90">Scan your face to mark attendance</div>
                </button>
                
                <!-- QR Code Option -->
                <button id="qrCodeBtn" class="w-full bg-green-600 text-white p-4 rounded-xl hover:bg-green-700 transition-colors">
                    <div class="text-3xl mb-2">üì±</div>
                    <div class="font-medium">QR Code Scan</div>
                    <div class="text-sm opacity-90">Scan classroom QR code</div>
                </button>
                
                <!-- Geolocation Option -->
                <button id="geolocationBtn" class="w-full bg-purple-600 text-white p-4 rounded-xl hover:bg-purple-700 transition-colors">
                    <div class="text-3xl mb-2">üìç</div>
                    <div class="font-medium">Location Verification</div>
                    <div class="text-sm opacity-90">Verify you're in the classroom</div>
                </button>
            </div>
            
            <button id="closeAttendanceModal" class="w-full mt-6 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                Cancel
            </button>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">Face Recognition</h2>
            
            <div class="camera-preview mb-4" id="cameraPreview">
                <video id="cameraVideo" class="w-full h-full object-cover rounded-lg" autoplay muted></video>
            </div>
            
            <div class="text-center mb-4">
                <p id="cameraStatus" class="text-gray-600">Position your face in the frame</p>
            </div>
            
            <div class="flex space-x-4">
                <button id="captureBtn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Capture</button>
                <button id="closeCameraModal" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Curriculum Upload Modal -->
    <div id="curriculumModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 w-full max-w-2xl">
            <h2 class="text-2xl font-bold mb-6">Upload Curriculum Content</h2>
            
            <form class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Course</label>
                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option>Computer Science 101</option>
                        <option>Data Structures</option>
                        <option>Database Systems</option>
                        <option>Software Engineering</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Content Type</label>
                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option>Lesson Plan</option>
                        <option>Course Outline</option>
                        <option>Assignment</option>
                        <option>Reading Material</option>
                        <option>Lab Manual</option>
                        <option>Lecture Notes</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                    <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enter content title">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg h-24" placeholder="Enter description"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload Files</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <div class="text-4xl mb-2">üìÅ</div>
                        <p class="text-gray-600">Drag and drop files here or click to browse</p>
                        <input type="file" class="hidden" multiple>
                        <button type="button" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Browse Files</button>
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button type="submit" id="submitCurriculum" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Upload Content</button>
                    <button type="button" id="closeCurriculumModal" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="hidden fixed top-16 right-4 bg-white rounded-xl shadow-2xl p-6 w-80 z-50">
        <h3 class="text-lg font-semibold mb-4">Notifications</h3>
        <div class="space-y-3">
            <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                <p class="text-sm font-medium text-red-800">Attendance Alert</p>
                <p class="text-xs text-red-600">23 students below 75% attendance threshold</p>
            </div>
            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm font-medium text-blue-800">New curriculum uploaded</p>
                <p class="text-xs text-blue-600">Database Systems - Advanced Queries</p>
            </div>
            <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-sm font-medium text-green-800">Placement Update</p>
                <p class="text-xs text-green-600">TechCorp visiting campus next week</p>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://your-project-url.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key-here';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Authorized Gmail addresses
        const AUTHORIZED_EMAILS = [
            'admin@edutrack.com',
            'teacher@edutrack.com', 
            'student@edutrack.com',
            'parent@edutrack.com'
            // Add your specific Gmail addresses here
        ];
        
        // Sample Students Data (20 students with varied attendance)
        const SAMPLE_STUDENTS = [
            { rollNo: 'CS2021001', name: 'Aarav Sharma', attendance: 95.2, attended: 40, total: 42, status: 'excellent', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021002', name: 'Vivaan Patel', attendance: 88.1, attended: 37, total: 42, status: 'good', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021003', name: 'Aditya Kumar', attendance: 72.4, attended: 30, total: 42, status: 'warning', lastSeen: '2024-01-14', department: 'CSE' },
            { rollNo: 'CS2021004', name: 'Vihaan Singh', attendance: 91.7, attended: 39, total: 42, status: 'excellent', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021005', name: 'Arjun Gupta', attendance: 45.2, attended: 19, total: 42, status: 'defaulter', lastSeen: '2024-01-10', department: 'CSE' },
            { rollNo: 'CS2021006', name: 'Sai Reddy', attendance: 83.3, attended: 35, total: 42, status: 'good', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021007', name: 'Reyansh Joshi', attendance: 67.9, attended: 28, total: 42, status: 'warning', lastSeen: '2024-01-13', department: 'CSE' },
            { rollNo: 'CS2021008', name: 'Ayaan Khan', attendance: 92.9, attended: 39, total: 42, status: 'excellent', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021009', name: 'Krishna Iyer', attendance: 58.3, attended: 24, total: 42, status: 'defaulter', lastSeen: '2024-01-12', department: 'CSE' },
            { rollNo: 'CS2021010', name: 'Ishaan Mehta', attendance: 79.8, attended: 33, total: 42, status: 'good', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021011', name: 'Shaurya Agarwal', attendance: 35.7, attended: 15, total: 42, status: 'defaulter', lastSeen: '2024-01-08', department: 'CSE' },
            { rollNo: 'CS2021012', name: 'Atharv Bansal', attendance: 86.9, attended: 36, total: 42, status: 'good', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021013', name: 'Kabir Malhotra', attendance: 71.4, attended: 30, total: 42, status: 'warning', lastSeen: '2024-01-14', department: 'CSE' },
            { rollNo: 'CS2021014', name: 'Shivansh Tiwari', attendance: 94.0, attended: 39, total: 42, status: 'excellent', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021015', name: 'Rudra Saxena', attendance: 52.4, attended: 22, total: 42, status: 'defaulter', lastSeen: '2024-01-11', department: 'CSE' },
            { rollNo: 'CS2021016', name: 'Aryan Verma', attendance: 89.3, attended: 37, total: 42, status: 'good', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021017', name: 'Kian Chopra', attendance: 64.3, attended: 27, total: 42, status: 'warning', lastSeen: '2024-01-13', department: 'CSE' },
            { rollNo: 'CS2021018', name: 'Advait Nair', attendance: 96.4, attended: 40, total: 42, status: 'excellent', lastSeen: '2024-01-15', department: 'CSE' },
            { rollNo: 'CS2021019', name: 'Yuvaan Das', attendance: 41.7, attended: 17, total: 42, status: 'defaulter', lastSeen: '2024-01-09', department: 'CSE' },
            { rollNo: 'CS2021020', name: 'Darsh Bhatt', attendance: 77.4, attended: 32, total: 42, status: 'good', lastSeen: '2024-01-15', department: 'CSE' }
        ];

        // Defaulter students (attendance < 75%)
        const DEFAULTER_STUDENTS = [
            { rollNo: 'CS2021005', name: 'Arjun Gupta', department: 'Computer Science', attendance: 45.2, missed: 23, severity: 'critical', parentContact: '+91-9876543210' },
            { rollNo: 'CS2021009', name: 'Krishna Iyer', department: 'Computer Science', attendance: 58.3, missed: 18, severity: 'high', parentContact: '+91-9876543211' },
            { rollNo: 'CS2021011', name: 'Shaurya Agarwal', department: 'Computer Science', attendance: 35.7, missed: 27, severity: 'critical', parentContact: '+91-9876543212' },
            { rollNo: 'CS2021015', name: 'Rudra Saxena', department: 'Computer Science', attendance: 52.4, missed: 20, severity: 'high', parentContact: '+91-9876543213' },
            { rollNo: 'CS2021019', name: 'Yuvaan Das', department: 'Computer Science', attendance: 41.7, missed: 25, severity: 'critical', parentContact: '+91-9876543214' },
            { rollNo: 'EC2021003', name: 'Ananya Sharma', department: 'Electronics', attendance: 68.5, missed: 13, severity: 'medium', parentContact: '+91-9876543215' },
            { rollNo: 'EC2021007', name: 'Diya Patel', department: 'Electronics', attendance: 72.1, missed: 12, severity: 'medium', parentContact: '+91-9876543216' },
            { rollNo: 'ME2021005', name: 'Rohan Singh', department: 'Mechanical', attendance: 61.9, missed: 16, severity: 'high', parentContact: '+91-9876543217' },
            { rollNo: 'ME2021012', name: 'Karthik Reddy', department: 'Mechanical', attendance: 55.2, missed: 19, severity: 'high', parentContact: '+91-9876543218' },
            { rollNo: 'CE2021008', name: 'Priya Gupta', department: 'Civil', attendance: 69.0, missed: 13, severity: 'medium', parentContact: '+91-9876543219' },
            { rollNo: 'CS2021003', name: 'Aditya Kumar', department: 'Computer Science', attendance: 72.4, missed: 12, severity: 'medium', parentContact: '+91-9876543220' },
            { rollNo: 'CS2021007', name: 'Reyansh Joshi', department: 'Computer Science', attendance: 67.9, missed: 14, severity: 'medium', parentContact: '+91-9876543221' },
            { rollNo: 'CS2021013', name: 'Kabir Malhotra', department: 'Computer Science', attendance: 71.4, missed: 12, severity: 'medium', parentContact: '+91-9876543222' },
            { rollNo: 'CS2021017', name: 'Kian Chopra', department: 'Computer Science', attendance: 64.3, missed: 15, severity: 'medium', parentContact: '+91-9876543223' },
            { rollNo: 'EC2021015', name: 'Sneha Iyer', department: 'Electronics', attendance: 48.8, missed: 21, severity: 'critical', parentContact: '+91-9876543224' },
            { rollNo: 'ME2021018', name: 'Vikram Joshi', department: 'Mechanical', attendance: 59.5, missed: 17, severity: 'high', parentContact: '+91-9876543225' },
            { rollNo: 'CE2021022', name: 'Neha Agarwal', department: 'Civil', attendance: 66.7, missed: 14, severity: 'medium', parentContact: '+91-9876543226' },
            { rollNo: 'EC2021009', name: 'Rahul Bansal', department: 'Electronics', attendance: 43.6, missed: 24, severity: 'critical', parentContact: '+91-9876543227' },
            { rollNo: 'ME2021007', name: 'Amit Sharma', department: 'Mechanical', attendance: 70.2, missed: 12, severity: 'medium', parentContact: '+91-9876543228' },
            { rollNo: 'CS2021025', name: 'Tanvi Mehta', department: 'Computer Science', attendance: 62.9, missed: 15, severity: 'medium', parentContact: '+91-9876543229' },
            { rollNo: 'EC2021018', name: 'Harsh Verma', department: 'Electronics', attendance: 54.8, missed: 19, severity: 'high', parentContact: '+91-9876543230' },
            { rollNo: 'ME2021021', name: 'Pooja Singh', department: 'Mechanical', attendance: 67.3, missed: 14, severity: 'medium', parentContact: '+91-9876543231' },
            { rollNo: 'CE2021014', name: 'Ravi Kumar', department: 'Civil', attendance: 58.1, missed: 18, severity: 'high', parentContact: '+91-9876543232' }
        ];
        
        // Application State
        let currentUser = null;
        let currentRole = null;
        let currentUserData = null;
        let cameraStream = null;

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const mainDashboard = document.getElementById('mainDashboard');
        const loginForm = document.getElementById('loginForm');
        const userRole = document.getElementById('userRole');
        const currentUserSpan = document.getElementById('currentUser');
        const logoutBtn = document.getElementById('logoutBtn');
        const biometricBtn = document.getElementById('biometricBtn');
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationPanel = document.getElementById('notificationPanel');

        // Dashboard Elements
        const adminDashboard = document.getElementById('adminDashboard');
        const teacherDashboard = document.getElementById('teacherDashboard');
        const studentDashboard = document.getElementById('studentDashboard');
        const parentDashboard = document.getElementById('parentDashboard');

        // Modal Elements
        const attendanceModal = document.getElementById('attendanceModal');
        const curriculumModal = document.getElementById('curriculumModal');
        const defaulterModal = document.getElementById('defaulterModal');
        const cameraModal = document.getElementById('cameraModal');

        // Button Elements
        const takeAttendanceBtn = document.getElementById('takeAttendanceBtn');
        const uploadCurriculumBtn = document.getElementById('uploadCurriculumBtn');
        const markAttendanceBtn = document.getElementById('markAttendanceBtn');
        const viewDefaultersBtn = document.getElementById('viewDefaultersBtn');
        const teacherDefaultersBtn = document.getElementById('teacherDefaultersBtn');

        // Close Modal Elements
        const closeAttendanceModal = document.getElementById('closeAttendanceModal');
        const closeCurriculumModal = document.getElementById('closeCurriculumModal');
        const closeDefaulterModal = document.getElementById('closeDefaulterModal');
        const closeCameraModal = document.getElementById('closeCameraModal');

        // Attendance Modal Buttons
        const faceRecognitionBtn = document.getElementById('faceRecognitionBtn');
        const qrCodeBtn = document.getElementById('qrCodeBtn');
        const geolocationBtn = document.getElementById('geolocationBtn');

        // Camera Elements
        const cameraVideo = document.getElementById('cameraVideo');
        const cameraStatus = document.getElementById('cameraStatus');
        const captureBtn = document.getElementById('captureBtn');

        // Database Helper Functions
        async function initializeDatabase() {
            try {
                await createTables();
                console.log('Database initialized successfully');
            } catch (error) {
                console.error('Database initialization error:', error);
            }
        }

        async function createTables() {
            const tables = {
                users: `
                    CREATE TABLE IF NOT EXISTS users (
                        id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                        email VARCHAR UNIQUE NOT NULL,
                        role VARCHAR NOT NULL CHECK (role IN ('admin', 'teacher', 'student', 'parent')),
                        full_name VARCHAR NOT NULL,
                        student_id VARCHAR,
                        department VARCHAR,
                        created_at TIMESTAMP DEFAULT NOW(),
                        updated_at TIMESTAMP DEFAULT NOW()
                    );
                `,
                students: `
                    CREATE TABLE IF NOT EXISTS students (
                        id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                        user_id UUID REFERENCES users(id),
                        student_id VARCHAR UNIQUE NOT NULL,
                        grade_level VARCHAR,
                        department VARCHAR,
                        parent_email VARCHAR,
                        enrollment_date DATE DEFAULT CURRENT_DATE,
                        created_at TIMESTAMP DEFAULT NOW()
                    );
                `,
                courses: `
                    CREATE TABLE IF NOT EXISTS courses (
                        id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                        course_code VARCHAR UNIQUE NOT NULL,
                        course_name VARCHAR NOT NULL,
                        teacher_id UUID REFERENCES users(id),
                        department VARCHAR,
                        credits INTEGER DEFAULT 3,
                        created_at TIMESTAMP DEFAULT NOW()
                    );
                `,
                attendance: `
                    CREATE TABLE IF NOT EXISTS attendance (
                        id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                        student_id UUID REFERENCES students(id),
                        course_id UUID REFERENCES courses(id),
                        date DATE DEFAULT CURRENT_DATE,
                        status VARCHAR CHECK (status IN ('present', 'absent', 'late')),
                        method VARCHAR CHECK (method IN ('face_recognition', 'qr_code', 'geolocation', 'manual')),
                        created_at TIMESTAMP DEFAULT NOW()
                    );
                `,
                curriculum: `
                    CREATE TABLE IF NOT EXISTS curriculum (
                        id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                        course_id UUID REFERENCES courses(id),
                        title VARCHAR NOT NULL,
                        content_type VARCHAR CHECK (content_type IN ('lesson_plan', 'assignment', 'reading_material', 'course_outline')),
                        description TEXT,
                        file_url VARCHAR,
                        created_by UUID REFERENCES users(id),
                        created_at TIMESTAMP DEFAULT NOW()
                    );
                `,
                enrollments: `
                    CREATE TABLE IF NOT EXISTS enrollments (
                        id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
                        student_id UUID REFERENCES students(id),
                        course_id UUID REFERENCES courses(id),
                        enrollment_date DATE DEFAULT CURRENT_DATE,
                        status VARCHAR DEFAULT 'active' CHECK (status IN ('active', 'completed', 'dropped')),
                        created_at TIMESTAMP DEFAULT NOW()
                    );
                `
            };

            console.log('Table schemas defined:', Object.keys(tables));
        }

        async function checkAuthorizedEmail(email) {
            return AUTHORIZED_EMAILS.includes(email) || email.endsWith('@gmail.com');
        }

        async function authenticateUser(email, password) {
            try {
                if (!await checkAuthorizedEmail(email)) {
                    throw new Error('Email not authorized for this system');
                }

                if (password === 'demo123') {
                    let userData = await getUserByEmail(email);
                    
                    if (!userData) {
                        userData = await createDemoUser(email);
                    }
                    
                    return userData;
                }
                
                throw new Error('Invalid credentials');
            } catch (error) {
                console.error('Authentication error:', error);
                throw error;
            }
        }

        async function getUserByEmail(email) {
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('email', email)
                    .single();

                if (error && error.code !== 'PGRST116') {
                    throw error;
                }

                return data;
            } catch (error) {
                console.error('Error fetching user:', error);
                return null;
            }
        }

        async function createDemoUser(email) {
            try {
                let role = 'student';
                if (email.includes('admin')) role = 'admin';
                else if (email.includes('teacher')) role = 'teacher';
                else if (email.includes('parent')) role = 'parent';

                const userData = {
                    email: email,
                    role: role,
                    full_name: `${role.charAt(0).toUpperCase() + role.slice(1)} User`,
                    department: role === 'student' ? 'Computer Science' : null,
                    student_id: role === 'student' ? 'STU' + Math.random().toString(36).substr(2, 6).toUpperCase() : null
                };

                const { data, error } = await supabase
                    .from('users')
                    .insert([userData])
                    .select()
                    .single();

                if (error) throw error;

                if (role === 'student') {
                    await createStudentRecord(data.id, userData.student_id);
                }

                return data;
            } catch (error) {
                console.error('Error creating demo user:', error);
                return {
                    id: 'demo-' + Math.random().toString(36).substr(2, 9),
                    email: email,
                    role: email.includes('admin') ? 'admin' : email.includes('teacher') ? 'teacher' : email.includes('parent') ? 'parent' : 'student',
                    full_name: 'Demo User',
                    student_id: 'DEMO123'
                };
            }
        }

        async function createStudentRecord(userId, studentId) {
            try {
                const { data, error } = await supabase
                    .from('students')
                    .insert([{
                        user_id: userId,
                        student_id: studentId,
                        grade_level: '10',
                        department: 'Computer Science'
                    }]);

                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error creating student record:', error);
            }
        }

        async function markAttendance(studentId, courseId, status, method) {
            try {
                const { data, error } = await supabase
                    .from('attendance')
                    .insert([{
                        student_id: studentId,
                        course_id: courseId,
                        status: status,
                        method: method,
                        date: new Date().toISOString().split('T')[0]
                    }]);

                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error marking attendance:', error);
                throw error;
            }
        }

        // Camera and Location Functions
        async function requestCameraPermission() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    } 
                });
                return stream;
            } catch (error) {
                console.error('Camera permission denied:', error);
                throw new Error('Camera access is required for face recognition attendance');
            }
        }

        async function requestLocationPermission() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation is not supported by this browser'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        });
                    },
                    (error) => {
                        let message = 'Location access denied';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                message = 'Location access denied by user';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                message = 'Location information unavailable';
                                break;
                            case error.TIMEOUT:
                                message = 'Location request timed out';
                                break;
                        }
                        reject(new Error(message));
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            });
        }

        function stopCameraStream() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
        }

        // Student Table Functions
        function populateStudentTable(students = SAMPLE_STUDENTS) {
            const tbody = document.getElementById('studentTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            students.forEach(student => {
                const row = document.createElement('tr');
                row.className = getRowClass(student.status);
                
                row.innerHTML = `
                    <td class="py-3 px-4 font-medium">${student.rollNo}</td>
                    <td class="py-3 px-4">${student.name}</td>
                    <td class="py-3 px-4">
                        <div class="flex items-center space-x-2">
                            <span class="font-bold ${getAttendanceColor(student.attendance)}">${student.attendance}%</span>
                            <div class="w-16 bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full ${getProgressBarColor(student.attendance)}" style="width: ${student.attendance}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="py-3 px-4">${student.attended}/${student.total}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusBadge(student.status)}">
                            ${getStatusText(student.status)}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-sm text-gray-600">${student.lastSeen}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="text-blue-600 hover:underline text-sm" onclick="viewStudentDetails('${student.rollNo}')">View</button>
                            <button class="text-orange-600 hover:underline text-sm" onclick="contactParent('${student.rollNo}')">Contact</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function populateDefaulterTable(defaulters = DEFAULTER_STUDENTS) {
            const tbody = document.getElementById('defaulterTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            defaulters.forEach(student => {
                const row = document.createElement('tr');
                row.className = getSeverityRowClass(student.severity);
                
                row.innerHTML = `
                    <td class="py-3 px-4 font-medium">${student.rollNo}</td>
                    <td class="py-3 px-4">${student.name}</td>
                    <td class="py-3 px-4">${student.department}</td>
                    <td class="py-3 px-4">
                        <span class="font-bold text-red-600">${student.attendance}%</span>
                    </td>
                    <td class="py-3 px-4 text-red-600">${student.missed} classes</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getSeverityBadge(student.severity)}">
                            ${student.severity.charAt(0).toUpperCase() + student.severity.slice(1)}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-sm">${student.parentContact}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="text-blue-600 hover:underline text-sm" onclick="sendWarning('${student.rollNo}')">Warning</button>
                            <button class="text-red-600 hover:underline text-sm" onclick="contactParent('${student.rollNo}')">Call Parent</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getRowClass(status) {
            switch(status) {
                case 'excellent': return 'excellent-row';
                case 'good': return 'good-row';
                case 'warning': return 'warning-row';
                case 'defaulter': return 'defaulter-row';
                default: return '';
            }
        }

        function getSeverityRowClass(severity) {
            switch(severity) {
                case 'critical': return 'defaulter-row';
                case 'high': return 'warning-row';
                case 'medium': return 'warning-row';
                default: return '';
            }
        }

        function getAttendanceColor(attendance) {
            if (attendance >= 90) return 'text-green-600';
            if (attendance >= 75) return 'text-blue-600';
            if (attendance >= 60) return 'text-yellow-600';
            return 'text-red-600';
        }

        function getProgressBarColor(attendance) {
            if (attendance >= 90) return 'bg-green-600';
            if (attendance >= 75) return 'bg-blue-600';
            if (attendance >= 60) return 'bg-yellow-600';
            return 'bg-red-600';
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'excellent': return 'bg-green-100 text-green-800';
                case 'good': return 'bg-blue-100 text-blue-800';
                case 'warning': return 'bg-yellow-100 text-yellow-800';
                case 'defaulter': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getSeverityBadge(severity) {
            switch(severity) {
                case 'critical': return 'bg-red-100 text-red-800';
                case 'high': return 'bg-orange-100 text-orange-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'excellent': return 'Excellent';
                case 'good': return 'Good';
                case 'warning': return 'Warning';
                case 'defaulter': return 'Defaulter';
                default: return 'Unknown';
            }
        }

        // Student Action Functions
        function viewStudentDetails(rollNo) {
            const student = SAMPLE_STUDENTS.find(s => s.rollNo === rollNo);
            if (student) {
                alert(`Student Details:\n\nName: ${student.name}\nRoll No: ${student.rollNo}\nAttendance: ${student.attendance}%\nClasses Attended: ${student.attended}/${student.total}\nLast Seen: ${student.lastSeen}`);
            }
        }

        function contactParent(rollNo) {
            const student = DEFAULTER_STUDENTS.find(s => s.rollNo === rollNo) || SAMPLE_STUDENTS.find(s => s.rollNo === rollNo);
            if (student) {
                const contact = student.parentContact || '+91-9876543210';
                alert(`Contacting parent for ${student.name}\nPhone: ${contact}\n\nA notification has been sent to the parent regarding attendance concerns.`);
            }
        }

        function sendWarning(rollNo) {
            const student = DEFAULTER_STUDENTS.find(s => s.rollNo === rollNo);
            if (student) {
                alert(`Warning sent to ${student.name} (${student.rollNo})\n\nThe student has been notified about their low attendance and the consequences of continued absence.`);
            }
        }

        // Filter Functions
        function filterStudents() {
            const filter = document.getElementById('attendanceFilter')?.value || 'all';
            let filteredStudents = SAMPLE_STUDENTS;

            switch(filter) {
                case 'excellent':
                    filteredStudents = SAMPLE_STUDENTS.filter(s => s.attendance >= 90);
                    break;
                case 'good':
                    filteredStudents = SAMPLE_STUDENTS.filter(s => s.attendance >= 75 && s.attendance < 90);
                    break;
                case 'warning':
                    filteredStudents = SAMPLE_STUDENTS.filter(s => s.attendance >= 60 && s.attendance < 75);
                    break;
                case 'defaulter':
                    filteredStudents = SAMPLE_STUDENTS.filter(s => s.attendance < 60);
                    break;
            }

            populateStudentTable(filteredStudents);
        }

        function filterDefaulters() {
            const departmentFilter = document.getElementById('departmentFilter')?.value || 'all';
            const severityFilter = document.getElementById('severityFilter')?.value || 'all';
            
            let filteredDefaulters = DEFAULTER_STUDENTS;

            if (departmentFilter !== 'all') {
                const deptMap = {
                    'cse': 'Computer Science',
                    'ece': 'Electronics',
                    'me': 'Mechanical',
                    'ce': 'Civil'
                };
                filteredDefaulters = filteredDefaulters.filter(s => s.department === deptMap[departmentFilter]);
            }

            if (severityFilter !== 'all') {
                filteredDefaulters = filteredDefaulters.filter(s => s.severity === severityFilter);
            }

            populateDefaulterTable(filteredDefaulters);
        }

        // Login Form Handler
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const role = userRole.value;

            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Signing in...';
                submitBtn.disabled = true;

                const userData = await authenticateUser(email, password);
                await login(userData, role);
            } catch (error) {
                alert(error.message);
            } finally {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Sign In';
                submitBtn.disabled = false;
            }
        });

        // Biometric Login Handler
        biometricBtn.addEventListener('click', function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 text-center">
                    <div class="face-scan-animation text-6xl mb-4">üë§</div>
                    <h3 class="text-xl font-bold mb-2">Face Recognition</h3>
                    <p class="text-gray-600 mb-4">Please look at the camera</p>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-3000" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500">Scanning...</p>
                </div>
            `;
            document.body.appendChild(modal);

            const progressBar = modal.querySelector('.bg-blue-600');
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.body.removeChild(modal);
                        login({ email: 'student@edutrack.com', role: 'student', full_name: 'Demo Student' }, 'student');
                    }, 500);
                }
            }, 200);
        });

        // Login Function
        async function login(userData, role = null) {
            currentUser = userData.email;
            currentRole = role || userData.role;
            currentUserData = userData;
            
            loginScreen.classList.add('hidden');
            mainDashboard.classList.remove('hidden');
            
            currentUserSpan.textContent = userData.full_name || `${currentRole.charAt(0).toUpperCase() + currentRole.slice(1)} User`;
            
            await showDashboard(currentRole);
            
            if (currentRole === 'admin') {
                setTimeout(initializeCharts, 100);
            }
            
            await loadUserData();
        }

        // Show Dashboard Based on Role
        async function showDashboard(role) {
            adminDashboard.classList.add('hidden');
            teacherDashboard.classList.add('hidden');
            studentDashboard.classList.add('hidden');
            parentDashboard.classList.add('hidden');
            
            switch(role) {
                case 'admin':
                    adminDashboard.classList.remove('hidden');
                    break;
                case 'teacher':
                    teacherDashboard.classList.remove('hidden');
                    populateStudentTable();
                    break;
                case 'student':
                    studentDashboard.classList.remove('hidden');
                    break;
                case 'parent':
                    parentDashboard.classList.remove('hidden');
                    break;
            }
        }

        // Load User-Specific Data
        async function loadUserData() {
            try {
                if (currentRole === 'student') {
                    await loadStudentData();
                } else if (currentRole === 'teacher') {
                    await loadTeacherData();
                } else if (currentRole === 'admin') {
                    await loadAdminData();
                } else if (currentRole === 'parent') {
                    await loadParentData();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function loadStudentData() {
            // Student data loading logic
        }

        async function loadTeacherData() {
            // Teacher data loading logic
        }

        async function loadAdminData() {
            // Admin data loading logic
        }

        async function loadParentData() {
            // Parent data loading logic
        }

        // Logout Handler
        logoutBtn.addEventListener('click', function() {
            currentUser = null;
            currentRole = null;
            stopCameraStream();
            loginScreen.classList.remove('hidden');
            mainDashboard.classList.add('hidden');
            loginForm.reset();
        });

        // Notification Panel Toggle
        notificationBtn.addEventListener('click', function() {
            notificationPanel.classList.toggle('hidden');
        });

        document.addEventListener('click', function(e) {
            if (!notificationBtn.contains(e.target) && !notificationPanel.contains(e.target)) {
                notificationPanel.classList.add('hidden');
            }
        });

        // Modal Event Listeners
        if (takeAttendanceBtn) {
            takeAttendanceBtn.addEventListener('click', () => {
                attendanceModal.classList.remove('hidden');
            });
        }

        if (markAttendanceBtn) {
            markAttendanceBtn.addEventListener('click', () => {
                attendanceModal.classList.remove('hidden');
            });
        }

        if (viewDefaultersBtn) {
            viewDefaultersBtn.addEventListener('click', () => {
                populateDefaulterTable();
                defaulterModal.classList.remove('hidden');
            });
        }

        if (teacherDefaultersBtn) {
            teacherDefaultersBtn.addEventListener('click', () => {
                populateDefaulterTable();
                defaulterModal.classList.remove('hidden');
            });
        }

        closeAttendanceModal.addEventListener('click', () => {
            attendanceModal.classList.add('hidden');
        });

        if (uploadCurriculumBtn) {
            uploadCurriculumBtn.addEventListener('click', () => {
                curriculumModal.classList.remove('hidden');
            });
        }

        closeCurriculumModal.addEventListener('click', () => {
            curriculumModal.classList.add('hidden');
        });

        closeDefaulterModal.addEventListener('click', () => {
            defaulterModal.classList.add('hidden');
        });

        closeCameraModal.addEventListener('click', () => {
            stopCameraStream();
            cameraModal.classList.add('hidden');
        });

        // Attendance Method Handlers
        faceRecognitionBtn.addEventListener('click', async function() {
            try {
                attendanceModal.classList.add('hidden');
                cameraModal.classList.remove('hidden');
                
                cameraStatus.textContent = 'Requesting camera permission...';
                cameraStream = await requestCameraPermission();
                
                cameraVideo.srcObject = cameraStream;
                cameraStatus.textContent = 'Position your face in the frame and click Capture';
                
            } catch (error) {
                alert(error.message);
                cameraModal.classList.add('hidden');
                attendanceModal.classList.remove('hidden');
            }
        });

        captureBtn.addEventListener('click', function() {
            cameraStatus.textContent = 'Processing face recognition...';
            captureBtn.disabled = true;
            
            setTimeout(() => {
                stopCameraStream();
                cameraModal.classList.add('hidden');
                simulateAttendanceSuccess('Face Recognition', 'Face recognized successfully!');
                captureBtn.disabled = false;
            }, 2000);
        });

        qrCodeBtn.addEventListener('click', function() {
            simulateAttendanceMethod('QR Code Scan', 'üì±', 'Scanning QR code...', 'QR code verified! Attendance marked successfully.');
        });

        geolocationBtn.addEventListener('click', async function() {
            try {
                attendanceModal.classList.add('hidden');
                
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 text-center w-full max-w-sm">
                        <div class="text-6xl mb-4">üìç</div>
                        <h3 class="text-xl font-bold mb-2">Location Verification</h3>
                        <p class="text-gray-600 mb-4">Getting your location...</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                            <div class="bg-purple-600 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-500">Please allow location access</p>
                    </div>
                `;
                document.body.appendChild(modal);

                const progressBar = modal.querySelector('.bg-purple-600');
                const statusText = modal.querySelector('.text-gray-600');
                
                // Animate progress while getting location
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 20;
                    progressBar.style.width = progress + '%';
                    if (progress >= 100) {
                        clearInterval(progressInterval);
                    }
                }, 200);

                const location = await requestLocationPermission();
                
                // Simulate location verification
                statusText.textContent = 'Verifying classroom location...';
                
                setTimeout(() => {
                    document.body.removeChild(modal);
                    simulateAttendanceSuccess('Location Verification', `Location verified! You are in the correct classroom.\nCoordinates: ${location.latitude.toFixed(6)}, ${location.longitude.toFixed(6)}`);
                }, 1000);
                
            } catch (error) {
                // Remove any existing modal
                const existingModal = document.querySelector('.fixed.inset-0');
                if (existingModal) {
                    document.body.removeChild(existingModal);
                }
                
                alert(error.message);
                attendanceModal.classList.remove('hidden');
            }
        });

        // Simulate Attendance Method
        async function simulateAttendanceMethod(method, icon, scanningText, successText) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 text-center w-full max-w-sm">
                    <div class="face-scan-animation text-6xl mb-4">${icon}</div>
                    <h3 class="text-xl font-bold mb-2">${method}</h3>
                    <p class="text-gray-600 mb-4" id="statusText">${scanningText}</p>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                        <div class="bg-green-600 h-2 rounded-full transition-all duration-3000" style="width: 0%"></div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const progressBar = modal.querySelector('.bg-green-600');
            const statusText = modal.querySelector('#statusText');
            let progress = 0;
            
            const interval = setInterval(async () => {
                progress += 15;
                progressBar.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    try {
                        if (currentRole === 'student' && currentUserData) {
                            const methodMap = {
                                'Face Recognition': 'face_recognition',
                                'QR Code Scan': 'qr_code',
                                'Location Verification': 'geolocation'
                            };
                            
                            const { data: studentData } = await supabase
                                .from('students')
                                .select('id')
                                .eq('user_id', currentUserData.id)
                                .single();
                            
                            if (studentData) {
                                const sampleCourseId = 'demo-course-1';
                                await markAttendance(
                                    studentData.id, 
                                    sampleCourseId, 
                                    'present', 
                                    methodMap[method] || 'manual'
                                );
                            }
                        }
                        
                        statusText.textContent = successText;
                        statusText.className = 'text-green-600 mb-4 font-medium';
                    } catch (error) {
                        console.error('Error marking attendance:', error);
                        statusText.textContent = successText;
                        statusText.className = 'text-green-600 mb-4 font-medium';
                    }
                    
                    setTimeout(() => {
                        document.body.removeChild(modal);
                        attendanceModal.classList.add('hidden');
                        showSuccessMessage('Attendance marked successfully!');
                        
                        if (currentRole === 'student') {
                            loadStudentData();
                        }
                    }, 1500);
                }
            }, 200);
        }

        function simulateAttendanceSuccess(method, message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 text-center w-full max-w-sm">
                    <div class="text-6xl mb-4 text-green-600">‚úÖ</div>
                    <h3 class="text-xl font-bold mb-2 text-green-600">Success!</h3>
                    <p class="text-gray-600 mb-4">${message}</p>
                    <button class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">OK</button>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('button').addEventListener('click', () => {
                document.body.removeChild(modal);
                showSuccessMessage('Attendance marked successfully!');
            });
        }

        // Show Success Message
        function showSuccessMessage(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-20 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Filter Event Listeners
        document.addEventListener('change', function(e) {
            if (e.target.id === 'attendanceFilter') {
                filterStudents();
            }
            if (e.target.id === 'departmentFilter' || e.target.id === 'severityFilter') {
                filterDefaulters();
            }
        });

        // Export Functions
        document.addEventListener('click', function(e) {
            if (e.target.id === 'exportAttendanceBtn') {
                alert('Attendance report exported successfully!\nFile: attendance_report_' + new Date().toISOString().split('T')[0] + '.xlsx');
            }
            if (e.target.id === 'exportDefaultersBtn') {
                alert('Defaulter report exported successfully!\nFile: defaulter_report_' + new Date().toISOString().split('T')[0] + '.xlsx');
            }
        });

        // Initialize Charts for Admin Dashboard
        function initializeCharts() {
            const attendanceCtx = document.getElementById('attendanceChart');
            if (attendanceCtx) {
                new Chart(attendanceCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                        datasets: [{
                            label: 'Attendance %',
                            data: [85, 89, 92, 87, 90, 88],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            const performanceCtx = document.getElementById('performanceChart');
            if (performanceCtx) {
                new Chart(performanceCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Computer Science', 'Electronics', 'Mechanical', 'Civil', 'Chemical'],
                        datasets: [{
                            data: [94, 87, 91, 85, 89],
                            backgroundColor: [
                                'rgb(59, 130, 246)',
                                'rgb(16, 185, 129)',
                                'rgb(245, 158, 11)',
                                'rgb(239, 68, 68)',
                                'rgb(139, 92, 246)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === attendanceModal) {
                attendanceModal.classList.add('hidden');
            }
            if (e.target === curriculumModal) {
                curriculumModal.classList.add('hidden');
            }
            if (e.target === defaulterModal) {
                defaulterModal.classList.add('hidden');
            }
            if (e.target === cameraModal) {
                stopCameraStream();
                cameraModal.classList.add('hidden');
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            document.getElementById('loginEmail').value = 'admin@edutrack.com';
            document.getElementById('loginPassword').value = 'demo123';
            
            await initializeDatabase();
            
            console.log(`
üöÄ EduTrack Enhanced System Features:

‚úÖ Attendance Criteria System:
   - Excellent: ‚â•90% (Green)
   - Good: 75-89% (Blue) 
   - Warning: 60-74% (Yellow)
   - Defaulter: <60% (Red)

‚úÖ Real Camera & Location Access:
   - Face recognition with actual camera permission
   - Geolocation verification for classroom attendance
   - QR code scanning simulation

‚úÖ Enhanced Student Management:
   - 20 sample students with varied attendance (35%-96%)
   - Defaulter list with 23 students below 75%
   - Filter by attendance levels and departments
   - Export functionality for reports

‚úÖ IIT-Style Features:
   - CGPA tracking and semester rankings
   - Placement preparation status
   - Fee status monitoring
   - Parent-teacher communication
   - Academic calendar integration
   - Department-wise performance analytics

‚úÖ Database Integration:
   - Supabase backend with proper schema
   - Real-time attendance tracking
   - Curriculum management system
   - User role-based access control

Current Status: Enhanced demo with real permissions
            `);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c598cb02bd8b82',t:'MTc1NzQwOTQ5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
